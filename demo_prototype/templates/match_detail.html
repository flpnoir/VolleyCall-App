{% extends "layout.html" %}
{% block content %}
<h1>{{ m.title }}</h1>
<p><strong>When:</strong> {{ m.datetime }} | <strong>Where:</strong> {{ m.location }}</p>
<p>{{ m.notes }}</p>

<h3>Attending {{ m.attending|length }}/{{ m.capacity }}</h3>
<ul class="list">
  {% for email in m.attending %}
    <li>
      {{ users[email].name }} ({{ email }})
      {% if email in m.paid %}
        <span class="pill ok">Paid</span>
      {% else %}
        <span class="pill">Unpaid</span>
      {% endif %}
    </li>
  {% else %}
    <li>No RSVPs yet.</li>
  {% endfor %}
</ul>

{% if session.get('email') %}
<form method="post" action="{{ url_for('rsvp', match_id=m.id) }}" style="margin-top:12px">
  <button class="btn" type="submit">
    {% if session.get('email') in m.attending %}Cancel RSVP{% else %}RSVP{% endif %}
  </button>
</form>

<form method="post" action="{{ url_for('mark_paid', match_id=m.id) }}" style="margin-top:8px">
  <button class="btn btn-secondary" type="submit">
    {% if session.get('email') in m.paid %}Clear Paid{% else %}Mark as Paid{% endif %}
  </button>
</form>
{% else %}
<p><a href="{{ url_for('login') }}">Login</a> to RSVP.</p>
{% endif %}
{% endblock %}